As Brad Williams walked the halls of the California state capitol in Sacramento on a recent afternoon, he spotted a small crowd of protesters battling state spending cuts. They wore shiny white buttons that said "We Love Jobs!" and argued that looming budget reductions will hurt the Golden State's working class.

Mr. Williams shook his head. "They're missing the real problem," he said.

The working class may be taking a beating from spending cuts used to close a cavernous deficit, Mr. Williams said, but the root of California's woes is its reliance on taxing the wealthy. 

Nearly half of California's income taxes before the recession came from the top 1% of earners: households that took in more than $490,000 a year. High earners, it turns out, have especially volatile incomes—their earnings fell by more than twice as much as the rest of the population's during the recession. When they crashed, they took California's finances down with them.

Mr. Williams, a former economic forecaster for the state, spent more than a decade warning state leaders about California's over-dependence on the rich. "We created a revenue cliff," he said. "We built a large part of our government on the state's most unstable income group."

New York, New Jersey, Connecticut and Illinois—states that are the most heavily reliant on the taxes of the wealthy—are now among those with the biggest budget holes. A large population of rich residents was a blessing during the boom, showering states with billions in tax revenue. But it became a curse as their incomes collapsed with financial markets.

Arriving at a time of greatly increased public spending, this reversal highlights the dependence of the states on the outsize incomes of the wealthy. The result for state finances and budgets has been extreme volatility.

Many states are drawing in less money, partly due to lower incomes among high earners. Compare income tax receipts state by state and see the change from 2007 to 2009.

In New York before the recession, the top 1% of earners, who made more than $580,000 a year, paid 41% of the state's income taxes in 2007, up from 25% in 1994, according to state tax data. The top 1% of taxpayers paid 40% or more of state income taxes in New Jersey and Connecticut. In Illinois, which has a flat income-tax rate of 5%, the top 15% paid more than half the state's income taxes.

This growing dependence on wealthy taxpayers is being driven by soaring salaries at the top of the income ladder and by the nation's progressive income taxes, which levy the highest rates on the highest taxable incomes. The top federal income-tax rate has fallen dramatically over the past century, from more than 90% during World War II to 35% today. But the top tax rate—which applies to joint filers reporting $379,000 in taxable income—is still twice as high as the rate for joint filers reporting income of $69,000 or less.

The future of federal income taxes on the wealthy remains in flux. The top tax rate is 35%, following the Congressional tax battle last year. But in 2013, the rate is scheduled to go back to 39.6% unless Congress takes further action.

State income taxes are generally less progressive than federal income taxes, and more than a half-dozen states have no income tax. Yet a number of states have recently hiked taxes on the top earners to raise revenue during the recession. New York, for instance, imposed a "millionaire's tax" in 2009 on those earning $500,000 or more, although the tax is expected to expire at the end of 2011. Connecticut's top income-tax rate has crept up to 6.5% from 4.5% in 2002, while Oregon raised the top tax rate to 11% from 9% for filers with income of more than $500,000. 

As they've grown, the incomes of the wealthy have become more unstable. Between 2007 and 2008, the incomes of the top-earning 1% fell 16%, compared to a decline of 4% for U.S. earners as a whole, according to the IRS. Because today's highest salaries are usually linked to financial markets—through stock-based pay or investments—they are more prone to sudden shocks.

The income swings have created more extreme booms and busts for state governments. In New York, the top 1% of taxpayers contribute more to the state's year-to-year tax swings than all the other taxpayers combined, according to a study by the Rockefeller Institute of Government. In its January report downgrading New Jersey's credit rating, Standard & Poor's stated that New Jersey's wealth "translates into a high ability to pay taxes but might also contribute to potential revenue volatility."

State budget shortfalls have other causes, of course, from high unemployment and weak retail sales to falling real-estate values and the rising costs of health-care and pensions. State spending has expanded rapidly over the past decade. California's total spending grew from $99.2 billion in 2000-01 to a projected $136 billion in 2010-11, not including federal funds, according to the state Department of Finance. Though California's spending slipped by 15% during the recession, it has since returned to near prerecession levels. 

Some states may get a lifeline this year from the financial markets. Starting late last year, California, New Jersey and others began seeing higher-than-expected income-tax revenues and capital-gains revenues, suggesting the start of the next boom cycle. Still, because many states based their spending plans on the assumption that the windfalls from the wealthy would return every year, they are now grappling with multibillion-dollar shortfalls. 

A recent study by the Pew Center on the States and the Rockefeller Institute found that in 2009, states overestimated their revenues by more than $50 billion, due largely to the unexpected fall-off in personal-income taxes. Sales and corporate taxes have also fallen, but they account for a much smaller share of tax revenue in many states.

Tax experts say the problems at the state level could spread to Washington, as the highest earners gain a larger share of both national income and the tax burden. The top 1% paid 38% of federal income taxes in 2008, up from 25% in 1991, and they earned 20% of all national income in 2008, up from 13% in 1991, according to the Tax Foundation.

"These revenues have a narcotic effect on legislatures," said Greg Torres, president of MassINC, a nonpartisan think tank. "They become numb to the trend and think the revenue picture is improving, but they don't realize the money is ephemeral."

Kicking the addiction has proven difficult, since it's so fraught with partisan politics. Republicans advocate lowering taxes on the wealthy to broaden state tax bases and reduce volatility. Democrats oppose the move, saying a less progressive tax system would only add to growing income inequality. 

In a blog post called "The Volatility Monster," California Democratic State Sen. Noreen Evans wrote that "the true response to solving the volatility problem is to make sure Californians are fully employed and decently paid. Preserving the state's progressive tax system is fundamental to combating the rising riches at the top and rising poverty at the bottom. Flattening our tax system would simply increase this already historic income inequality," she wrote. 

U.S. Rep. Tom McClintock (R., Calif.) has for years advocated a flat tax in California to reduce volatility and keep high-earners from leaving the state. "California has one of the most steeply disproportionate income taxes in the nation," he said. "A flatter, broader tax rate would help stabilize the most volatile of California's revenues."

Rainy-day funds, which can help bail out governments during recessions, have also run into political opposition or proven too small to save state budgets. A study by the Center on Budget and Policy Priorities found that effective rainy day funds should be 15% of state operating expenditures—more than three times the state average before the crisis. Massachusetts, which saw a 75% drop in capital-gains collections during the recession, won plaudits from ratings firms and economists for creating a rainy-day fund in 2010 using future capital-gains revenues.

Economists and state budget chiefs say the best hedge is better planning. Budget staffers in New York, for instance, now spend more time studying Wall Street pay and bonuses to more accurately predict state revenues. The state's budget director avoids overly optimistic forecasts based on a previous year's strong growth.

"We're glad we have the revenue from the wealthy, and we want to encourage these people to stay and prosper," said Robert L. Megna, budget director for New York state. "But we have to recognize that because you have them, you'll have this big volatility."

The story of Mr. Williams, the former chief economist and forecaster for the California Legislative Analyst's Office, shows just how vulnerable states have become to the income shocks among the rich, and why reform has proven difficult. 

In the mid-1990s, shortly after taking the job, Mr. Williams discovered he had a problem. Part of his job was to help state politicians plan their budgets and tax projections. 

A lanky, 6-foot-4-inch 58-year-old, with piercing blue eyes and a fondness for cycling, Mr. Williams prided himself on his deep data dives. The Wall Street Journal named him California's most accurate forecaster in 1998 for his work the prior decade. He and his team placed a special focus on employment and age data and developed their own econometric models to make improvements.

Historically, California's tax revenues tracked the broader state economy. Yet in the mid-1990s, Mr. Williams noticed that they had started to diverge. Employment was barely growing while income-tax revenue was soaring. 

"It was like we suddenly had two different economies," Mr. Williams said. "There was the California economy and then there were personal income taxes."

In all his years of forecasting, he had rarely encountered such a puzzle. He did some economic sleuthing and discovered that most of the growth was coming from a small group of high earners. The average incomes of the top 20% of Californian earners (households making $95,000 in 1998) jumped by an inflation-adjusted 75% between 1980 and 1998, while incomes for the rest of the state grew by less than 3% over the same period. Capital-gains realizations—largely stock sales—quadrupled between 1994 and 1999, to nearly $80 billion. 

Mr. Williams reported his findings in early 2000, in a report called "California's Changing Income Distribution," which was widely circulated in the state capital. He wrote that state tax collections would be "subject to more volatility than in the past."

Mr. Williams wasn't the only one noticing the state's dependence on the wealthy. Economists and governors had for years lamented the state's high tax rates on the rich, and in 2009 a bipartisan commission set up by then Gov. Arnold Schwarzenegger recommended an across-the-board reduction in income-tax rates and a broader sales tax to reduce the state's dependence on the wealthy. The income-tax rate on Californians making more than $1 million a year is 10.3%, compared to less than 6% for those making under $26,600. Combined with the rising share of income going to the top, the state's progressive rates amplify the impact of the income gains or losses of the wealthy.

California's dependence on income taxes has also grown because of its shifting economy. Income taxes now account for more than half of its general revenue, up from about a third in 1981. Because the state's sales and use tax applies mainly to goods, rather than faster-growing services, it has declined in importance. The state's corporate tax has also shrunk relative to income taxes because of tax credits and other changes.

By the late 1990s, Mr. Williams realized that his job had changed. California's future was no longer tied to the broader economy, but to a small group of ultra-earners. To predict the state's revenue, he had to start forecasting the fortunes of the rich. That meant forecasting the performance of stocks—specifically, a handful of high-tech stocks.

He pored over SEC filings for Apple, Oracle and other California tech giants. He met with the financial advisers to the rich, asking them about the investment plans of their clients. He watched daily stock movements and stock sales reported by the state's tax collectors. 

Working with the state's tax collectors, he did a geographic breakdown of capital gains. The vast majority were in Silicon Valley.

"We knew there was a bubble," he said, "We just didn't know when it would fall, or by how much."

After the dot-com bust, the state's revenues from capital gains fell by more than two-thirds, to $5 billion in 2003 from $17 billion in 2001, while personal-income taxes fell 15% over the same period. The recession created a mirror image of the boom, with the wealthy leading the crash and dragging tax revenues down with them. By 2002, California had a budget shortfall of more than $20 billion. 

The deficit lingered for years, but its lessons seemed to be quickly forgotten in the state capital. By 2005, California was enjoying another surge in spending fed by the incomes of the wealthy. 

Mr. Williams started warning of another government crisis. In 2005, he released a report stating that the state's tax revenues could vary by as much as $6 billion in a single year, and that such swings were "more likely than not." He recommended several potential reforms, including flatter income-tax rates, "income averaging," which allows the wealthy to spread their tax payments for unusual windfalls over a longer period of time, and a rainy-day fund.

His proposals failed to gain any traction with the legislature. Many Democrats refused to consider tax hikes on the middle class and lower rates for the rich. In 2009, voters rejected a proposed spending cap, which among other things, would have helped to create a rainy-day fund.

One of the leading advocates for such a fund is Roger Niello, a former Republican assemblyman who has long been among the top 1% of state earners. He and his family own a chain of luxury car dealerships, and during the recession, his income fell by more than half because of the decline of auto sales. Though he's still "fine financially," he said, his personal experience taught him that "people in this income group have the most variable incomes."

Darrell Steinberg, the Democratic leader of the state senate, agrees that the dependence on the wealthy is "one of our most fundamental problems." Yet he concedes that his own spending priorities—including a large expansion of mental-health programs funded by a millionaire's tax—have added to the current mismatch between revenues and spending.

"I have no regrets given the number of people we've helped," he said. "But I guess you could say I did my part with spending."

As time went by, Mr. Williams became increasingly frustrated. To do his job properly, he had to predict the stock market. "And that's impossible," he said. He also felt that all of his research and warnings fell on deaf ears. In 2007, he decided to retire, and he now he works for a consulting firm.

"I was a broken record," he said. "I just kept saying the same thing over and over. And with my job, there was no real pleasure in being right."

—Vauhini Vara contributed to this article.

 Write to  Robert Frank at robert.frank@wsj.com 