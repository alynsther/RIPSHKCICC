SAN'A, Yemen—Armed men opened fire on crowds of antigovernment protesters Friday in Yemen's capital, killing an estimated 45 people and injuring hundreds—prompting Yemeni President Ali Abdullah Saleh to declare a state of emergency and suggesting his government has shifted to a hard line against its hardening opposition. 

Friday's bloodshed marked the most significant escalation in violence in Yemen's capital since protesters began in January to call for the end of Mr. Saleh's 32-year regime. The one-day death toll stood higher than the estimated 40 demonstration-linked fatalities in Yemen until now.

The day's violence began after Friday prayers, a time city residents have in recent weeks joined protesters who are camped near San'a University. Several people who saw Friday's crowds estimated the demonstrators numbered 100,000 or more, San'a's largest protests yet. 

Gunfire rang out. Gunmen could be seen firing into a crowd of thousands from atop buildings. Black smoke poured from the edge of the demonstration site. Some witnesses said the smoke came from burning tires, in a screen that helped mask the gunmen's position. 

Within hours of the incident, Mr. Saleh declared a state of emergency that clamps down on freedom of movement, the right to gather and the publication of materials. The emergency law exempts police from Yemen's criminal code when they are carrying out inspections and arrests, according to local media. 

Recent clashes in San'a have been marked by large numbers of security forces firing live ammunition, rubber bullets, tear gas and water cannons to disperse demonstrators. 

Witnesses said there were no security forces visible during Friday's shooting. Those who fired on the crowds, they said, were wearing civilian clothes. 

Mr. Saleh, in the news conference in which he announced emergency measures, expressed sorrow and blamed protesters for the violence. "It is clear there are armed elements inside these tents and they are the ones who opened fire," he said.

Track events day by day.

The U.S., in an unusually blunt statement directed against a U.S. ally and aid recipient, sharply criticized the use of force. 

"I strongly condemn the violence that has taken place in Yemen today and call on President Saleh to adhere to his public pledge to allow demonstrations to take place peacefully. Those responsible for today's violence must be held accountable," President Barack Obama said in the statement. 

Top White House counterterrorism adviser John Brennan, speaking in New York, said he planned to call Mr. Saleh on Friday. He said the U.S. "condemns in the strongest terms" the use of violence against peaceful protesters. The statements were the strongest U.S. condemnations yet of Yemen's response to the unrest, reflecting growing tension with Mr. Saleh, a key U.S. partner in the campaign against Yemen-based al Qaeda in the Arabian Peninsula. 

Yemen's opposition members saw the declaration as a last bid by Mr. Saleh to suppress protest under the protection of the law. "The widespread killing that took place today, followed by the declaration of emergency law, demonstrate that the power of the people on the street has become greater than that of the government," said opposition spokesman Mohammed al-Sabri. 

In the weeks since the January fall of Tunisia's Zine Abedine Ben Ali sparked Yemen's protest movement, Mr. Saleh has offered a host of political and economic concessions to opponents, including a pledge to step down in 2013. But public distrust of his regime, coupled with confidence inspired by the ousting of Egypt's Hosni Mubarak, have seen the opposition continue to grow. A week ago, opposition representatives were swift to reject Mr. Saleh's most sweeping reform proposal to date, an offer to turn the government into a parliamentary system. 

Mr. Saleh said the decision to impose emergency law came from Yemen's national security council, a body of military leaders. He didn't say how long it may last. The Yemeni constitution says the president must present the law within a week to the country's house of representatives, a body largely loyal to Mr. Saleh. 

Friday's events suggest the space for dialogue may be closing. "This may be a point that shows that the regime has chosen a violent path and that it will continue to use violence to retain power," said Yemeni political analyst Abdul Ghani al-Iryani.

During Friday's initial chaos, demonstrators charged toward the center of the violence amid bursts of gunfire, screaming that the movement must be united. In the middle of the densely packed area where shots were fired, some held open their jackets in defiance.

 At one point, protesters captured one of the men they believed to be involved in the shooting. Dozens seized upon the man, who disappeared beneath a flurry of fists and sticks and was dragged away. His fate was unclear.

A stream of dead and wounded bodies were rushed to a nearby mosque, now a makeshift hospital staffed by volunteers. Inside the inner prayer room, 21 young men lay dead, nearly all from bullet wounds to the head or neck. More bodies had been taken to a nearby hospital. By day's end, Dr. Wasim al-Qershi, who was on the scene, said 45 people had died and more than 500 were injured.

After the gunfire had subsided, protesters stormed a building where gunmen had been spotted, claiming it belonged to the governor of al-Mahwit province. They then torched the building.

 As violence has intensified in recent weeks, thousands of tribesmen from outside the capital have come to San'a to join protesters. Until today, many believed that their presence acted as a deterrent to the use of excessive force. Yemen's tribes are known for retaliatory violence and are heavily armed.  Those tribes that have joined the protests have done so in peace, they say, without bringing weapons.

"Ali Abdullah Saleh says that we are the violent ones, that we are terrorists," said Salah al-Rashid, a tribesman from al-Jowf, a conflict-prone region where clashes with the government have broken out as recently as this week. "Look at what happened today. He wants a violent response from the tribes so that he can turn this into Libya—but we are committed to peace.